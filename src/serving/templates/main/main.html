{% extends 'layouts/base.html'%}

{% block contentA %}
<div class="dashboard">
    <div class="sidebar">
        <h2>ğŸ›¡ï¸ Security Dashboard</h2>
        <div class="nav-item active" onclick="showTab('prediction')">ğŸ”® Live Prediction</div>
        <div class="nav-item" onclick="showTab('batch')">ğŸ“¤ Batch Upload</div>
        <div class="nav-item" onclick="showTab('explanations')">ğŸ’¡ Explanations</div>
        <!-- Disabled until backend endpoints exist -->
        <!-- <div class="nav-item" onclick="showTab('overview')">ğŸ“Š Overview</div>
        <div class="nav-item" onclick="showTab('features')">ğŸ¯ Features</div>
        <div class="nav-item" onclick="showTab('comparison')">âš–ï¸ Comparison</div> -->
    </div>
    
    <div class="main-content">
        <div class="header">
            <h1>ğŸ›¡ï¸ Explainable Risk Scoring</h1>
            <div style="color: #666;">Cascade RF â†’ Transformer with SHAP Explanations</div>
        </div>
{% endblock contentA %}

{% block contentB %}
        <!-- Live Prediction Tab -->
        <div id="prediction" class="tab-content" style="display: block;">
            <div class="prediction-panel">
                <div class="input-form">
                    <h3>ğŸ“ Enter Event Data</h3>
                    <form id="predictionForm">
                        <div class="form-group">
                            <label>File Size (MB)</label>
                            <input type="number" name="megabytes_sent" value="25.8" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label>Hour (0-23)</label>
                            <input type="number" name="hour" value="23" min="0" max="23" required>
                        </div>
                        <div class="form-group">
                            <label>Destination Domain</label>
                            <input type="text" name="destination_domain" value="external.com" required>
                        </div>
                        <div class="form-group">
                            <label>Channel</label>
                            <select name="channel" required>
                                <option value="HTTP">HTTP</option>
                                <option value="EMAIL">EMAIL</option>
                                <option value="USB">USB</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>First Time Destination?</label>
                            <select name="first_time_destination" required>
                                <option value="false">No</option>
                                <option value="true" selected>Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>After Hours?</label>
                            <select name="after_hours" required>
                                <option value="false">No</option>
                                <option value="true" selected>Yes</option>
                            </select>
                        </div>
                        <button type="submit" class="btn" style="background: #667eea; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">
                            ğŸ” Predict Risk
                        </button>
                    </form>
                </div>
                
                <div class="results-panel">
                    <h3>âš¡ Prediction Results</h3>
                    <div id="predictionResults" style="padding: 20px; color: #999;">
                        Submit a prediction to see results
                    </div>
                </div>
            </div>
        </div>

        <!-- Batch Upload Tab -->
        <div id="batch" class="tab-content" style="display: none;">
            <div class="batch-panel">
                <div style="padding: 20px;">
                    <h3>ğŸ“¤ Batch Upload & Predict</h3>
                    <p style="color: #666; margin: 12px 0;">Upload CSV or JSON file with multiple events for batch processing.</p>
                    
                    <div style="margin: 20px 0; padding: 24px; border: 2px dashed #667eea; border-radius: 8px; text-align: center; cursor: pointer; background: #f8f9ff;">
                        <input type="file" id="batchUploadForm" accept=".csv,.json" style="display: none;">
                        <div onclick="document.getElementById('batchUploadForm').click();" style="cursor: pointer;">
                            ğŸ“ Click to upload or drag & drop
                            <p style="font-size: 12px; color: #999; margin-top: 8px;">CSV or JSON (max 1000 events)</p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>ğŸ“‹ Expected Format (CSV):</h4>
                        <pre style="background: #f5f5f5; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 12px;">megabytes_sent,hour,destination_domain,channel,first_time_destination,after_hours
25.8,23,external.com,HTTP,true,true
0.5,10,internal.com,SFTP,false,false
100.2,2,dropbox.com,HTTP,true,true</pre>
                    </div>
                </div>
                
                <div id="batchResults" style="padding: 20px; margin-top: 20px; background: #f8f9fa; border-radius: 8px;">
                    <p style="color: #999;">Upload a file to see results</p>
                </div>
            </div>
        </div>
{% endblock contentB %}

{% block contentC %}
        <!-- Explanations Tab -->
        <div id="explanations" class="tab-content" style="display: none;">
            <div class="chart-container">
                <div class="chart-title">
                    ğŸ” AI Explainability
                    <span class="risk-badge" id="confidenceBadge" style="float: right;">Confidence: -</span>
                </div>
                
                <div id="shapFactors" class="feature-list" style="margin: 20px 0;">
                    <p style="color: #999;">Make a prediction to see feature contributions</p>
                </div>
                
                <div class="explanation-summary">
                    <p id="whyFlagged">Run a prediction to see explanation...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock contentC %}